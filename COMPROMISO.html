<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MARKET COMPROMISO</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        :root {
            --cq3-gold: #e2c08d;
            --cq3-border: #c5a059;
            --cq3-dark-panel: #121820;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: #050505;
            background-image: radial-gradient(#1a1a1a 1px, transparent 1px);
            background-size: 4px 4px;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .main-card {
            width: 420px;
            background: linear-gradient(180deg, #16222e 0%, #000000 100%);
            border: 1px solid var(--cq3-border);
            border-radius: 4px;
            padding: 30px;
            box-shadow: 0 0 40px rgba(197, 160, 89, 0.25), inset 0 0 15px rgba(197, 160, 89, 0.1);
            position: relative;
        }

        /* --- Tooltip Ajustado hacia Abajo --- */
        .info-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .info-btn {
            background: none;
            border: 1px solid var(--cq3-gold);
            color: var(--cq3-gold);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            cursor: help;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: 0.3s;
        }

        .info-btn:hover {
            background: var(--cq3-gold);
            color: #000;
        }

        .tooltip {
            visibility: hidden;
            width: 300px;
            background-color: rgba(10, 15, 20, 0.98);
            color: #fff;
            text-align: left;
            border: 1px solid var(--cq3-gold);
            padding: 15px;
            border-radius: 4px;
            position: absolute;
            z-index: 1000;
            /* Cambio de posición a Abajo */
            top: 130%; 
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
            line-height: 1.4;
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
            pointer-events: none;
        }

        /* Flecha del tooltip apuntando hacia arriba */
        .tooltip::after {
            content: "";
            position: absolute;
            bottom: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent var(--cq3-gold) transparent;
        }

        .info-header:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        /* --- Resto de la Interfaz --- */
        h2.title-small { color: var(--cq3-gold); font-size: 0.9em; letter-spacing: 4px; margin: 0; opacity: 0.8; }
        h1.title-main { color: #ffffff; text-align: center; font-size: 1.3em; margin: 10px 0 25px 0; }
        .progress-container { margin-bottom: 25px; }
        .stats { display: flex; justify-content: space-between; font-size: 0.75em; color: var(--cq3-gold); margin-bottom: 8px; font-weight: bold; }
        .bar-bg { height: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(197, 160, 89, 0.4); border-radius: 10px; overflow: hidden; }
        .bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #8a6d3b, #f3cf7a, #8a6d3b); box-shadow: 0 0 15px rgba(243, 207, 122, 0.6); transition: width 1.5s ease; }
        .price-item { display: flex; justify-content: space-between; padding: 10px 8px; background: rgba(255,255,255,0.03); border-left: 2px solid var(--cq3-gold); margin-bottom: 4px; font-size: 0.85em; }
        .val { color: #00ffcc; font-weight: bold; }
        .actions { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        input { background: #000; border: 1px solid var(--cq3-border); color: #fff; padding: 12px; text-align: center; border-radius: 2px; }
        .btn { background: var(--cq3-border); color: #000; border: none; padding: 14px; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.8em; }
        .btn:hover { background: #fff2ac; box-shadow: 0 0 15px var(--cq3-gold); }
        .btn-list { background: transparent; color: var(--cq3-gold); border: 1px solid var(--cq3-gold); }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; align-items: center; justify-content: center; }
        .modal-content { width: 85%; max-width: 900px; height: 70vh; background: #0a0e14; border: 1px solid var(--cq3-border); display: flex; flex-direction: column; }
        .modal-header { padding: 15px; border-bottom: 1px solid var(--cq3-border); display: flex; justify-content: space-between; background: rgba(197, 160, 89, 0.1); }
        .modal-body { flex: 1; overflow-y: auto; padding: 20px; }
        .voters-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }
        .v-tag { font-size: 0.75em; color: #bbb; border-bottom: 1px solid #222; padding: 5px; }
    </style>
</head>
<body>

<div class="main-card">
    <div class="info-header">
        <h2 class="title-small">MARKET COMPROMISO</h2>
        <div class="info-btn">?</div>
        <div class="tooltip">
            <strong>Objetivo del Protocolo:</strong><br><br>
            Esta iniciativa busca establecer un <strong>compromiso moral y pacífico</strong> entre los comerciantes de Conquer Classic 2.0. <br><br>
            La meta es preservar la armonía económica del servidor classic 2.0, evitando la devaluación agresiva de ítems clave. Al firmar, manifiestas tu voluntad de no dañar el mercado bajando precios de forma desmedida por desesperación de venta, promoviendo así un comercio justo y duradero para todos.
        </div>
    </div>
    
    <h1 class="title-main">PACTO DE MERCADO Conquer 2.0</h1>
    
    <div class="progress-container">
        <div class="stats">
            <span id="labelTotal">0 FIRMAS</span>
            <span>META: 500</span>
        </div>
        <div class="bar-bg"><div class="bar-fill" id="bar"></div></div>
    </div>

    <div class="price-list">
        <div class="price-item"><span>Cajas de Luna</span><span class="val">38-40 CPS</span></div>
        <div class="price-item"><span>Metbojotes</span><span class="val">7-8 CPS</span></div>
        <div class="price-item"><span>Aguanieve</span><span class="val">20-23 CPS</span></div>
        <div class="price-item"><span>Nirvana</span><span class="val">50-55 CPS</span></div>
        <div class="price-item"><span>Agualimpia</span><span class="val">40-45 CPS</span></div>
    </div>

    <div class="actions">
        <input type="text" id="nick" placeholder="NICK DEL PERSONAJE" maxlength="15">
        <button class="btn" onclick="firmar()">COMPROMETERSE</button>
        <button class="btn btn-list" onclick="toggleModal(true)">VER LISTADO DE FIRMANTES</button>
    </div>
</div>

<div id="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span style="color:var(--cq3-gold); font-weight:bold;">LISTADO DE FIRMANTES</span>
            <span style="cursor:pointer; color:var(--cq3-gold)" onclick="toggleModal(false)">[ CERRAR ]</span>
        </div>
        <div class="modal-body">
            <div id="votersGrid" class="voters-grid"></div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBqqyN4XvbSrZgr9j2nVlXKDbDk8z2RebM",
        authDomain: "revelacion-82a04.firebaseapp.com",
        projectId: "revelacion-82a04",
        storageBucket: "revelacion-82a04.firebasestorage.app",
        messagingSenderId: "954477353471",
        appId: "1:954477353471:web:491061723260aca764efca"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const META = 500;
    const BASE_DISPLAY = 0;

    db.ref('votantes').on('value', (snapshot) => {
        const data = snapshot.val() || {};
        actualizarInterfaz(Object.values(data));
    });

    function firmar() {
        const input = document.getElementById('nick');
        const nick = input.value.trim().toUpperCase();
        if(nick.length < 3) return alert("Ingresa un Nick válido");

        db.ref('votantes').once('value', (s) => {
            const list = Object.values(s.val() || {});
            if(list.includes(nick)) return alert("Ya has firmado este pacto.");
            db.ref('votantes').push(nick).then(() => { input.value = ""; });
        });
    }

    function actualizarInterfaz(votos) {
        const total = BASE_DISPLAY + votos.length;
        document.getElementById('labelTotal').innerText = `${total} FIRMAS`;
        document.getElementById('bar').style.width = Math.min((total/META)*100, 100) + "%";

        const grid = document.getElementById('votersGrid');
        grid.innerHTML = "";
        votos.reverse().forEach(name => {
            const d = document.createElement('div');
            d.className = 'v-tag';
            d.innerText = "» " + name;
            grid.appendChild(d);
        });
    }

    function toggleModal(show) {
        document.getElementById('modal').style.display = show ? 'flex' : 'none';
    }
</script>

</body>
</html>
